# RamaLama Docker - –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ —Å uv + buildx

## üöÄ –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ RamaLama —Å **Variant B** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:

- **uv** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (3-5x –±—ã—Å—Ç—Ä–µ–µ pip)
- **docker buildx bake** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Variant B**: –¢–æ–ª—å–∫–æ `./models` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å —Ö–æ—Å—Ç–∞, –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **Makefile** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π CLI
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `config/.env`

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
# 1. –°–±–æ—Ä–∫–∞ —Å uv + buildx (~3-5 –º–∏–Ω—É—Ç –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
make buildx

# 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make up

# 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
make pull MODEL=tinyllama

# 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
make serve MODEL=tinyllama PORT=8080
```

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏
```bash
# –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é (~30 —Å–µ–∫—É–Ω–¥)
make build

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
make rebuild
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Variant B - –¢–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ –Ω–∞ —Ö–æ—Å—Ç–µ
```
–•–æ—Å—Ç                         –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ ./models/    ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  /workspace/models
‚îú‚îÄ‚îÄ config/.env  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  /workspace/config (ro)
‚îî‚îÄ‚îÄ (–æ—Å—Ç–∞–ª—å–Ω–æ–µ)             ‚îî‚îÄ‚îÄ /workspace/{logs,data,cache}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Variant B
- ‚úÖ –ú–æ–¥–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ –õ–æ–≥–∏ –∏ –∫—ç—à –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

## üîß Makefile –∫–æ–º–∞–Ω–¥—ã

### –°–±–æ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
make build              # –û–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞
make rebuild            # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
make buildx             # –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ —Å buildx
make test               # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```

### –ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```bash
make up                 # –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
make down               # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make restart            # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make shell              # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞
make logs               # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make health             # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
```

### –ú–æ–¥–µ–ª–∏
```bash
make pull MODEL=tinyllama     # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏
make list                     # –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
make info                     # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
make serve MODEL=tinyllama    # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```

### –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
```bash
make config                   # –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
make clean                    # –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
make help                     # –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ramalama-project/
‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage —Å uv
‚îú‚îÄ‚îÄ docker-bake.hcl         # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ docker-compose.yml      # Variant B –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Makefile               # –û—Å–Ω–æ–≤–Ω–æ–π CLI
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ .env              # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ models/               # –ú–æ–¥–µ–ª–∏ (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å —Ö–æ—Å—Ç–∞)
‚îú‚îÄ‚îÄ entrypoint.sh         # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ BUILD_GUIDE.md    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îî‚îÄ‚îÄ README.md         # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config/.env
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `config/.env`:

```bash
# –ü—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
HTTP_PROXY=http://127.0.0.1:2080
HTTPS_PROXY=http://127.0.0.1:2080

# RamaLama –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RAMALAMA_MODELS_PATH=/workspace/models
RAMALAMA_ENGINE=llama.cpp
RAMALAMA_LOG_LEVEL=ERROR

# Docker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
IMAGE_NAME=ramalama
IMAGE_TAG=latest
CONTAINER_NAME=ramalama

# –ú–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_MODEL=llama3.2:1b
DEFAULT_SERVE_PORT=8080
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
make logs

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª
make logs > container.log &
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
make health
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Docker
docker system prune -a

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
make rebuild
```

#### –ú–æ–¥–µ–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π
make config | grep RAMALAMA

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
ls -la models/

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∑–∞–Ω–æ–≤–æ
make pull MODEL=tinyllama
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∫—Å–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–∫—Å–∏
make config | grep PROXY

# –ó–∞–ø—É—Å–∫ –±–µ–∑ –ø—Ä–æ–∫—Å–∏
docker-compose up -d --profile no-proxy
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
```bash
make info                     # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
make test                     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
docker-compose exec ramalama ramalama info
docker-compose exec ramalama ls -la /workspace/
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
- **–°–±–æ—Ä–∫–∞**: 3-5 –º–∏–Ω—É—Ç (–∑–∞–≥—Ä—É–∑–∫–∞ uv, Python –ø–∞–∫–µ—Ç—ã)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏**: 1-5 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞)

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏
- **–°–±–æ—Ä–∫–∞**: ~30 —Å–µ–∫—É–Ω–¥ (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é —Å–ª–æ—ë–≤)
- **–ó–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–∏**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ (—É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make buildx` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤ Docker —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–±–æ—Ä–∫–∏
- uv –∑–∞–º–µ–Ω—è–µ—Ç pip –¥–ª—è 3-5x –±—ã—Å—Ç—Ä–µ–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### Multi-platform —Å–±–æ—Ä–∫–∞
```bash
# –î–ª—è ARM64 –∏ AMD64
docker buildx bake -f docker-bake.hcl default --push
```

### Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞
make bake-prod

# –ó–∞–ø—É—Å–∫ —Å —Ä–µ—Å—É—Ä—Å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
docker-compose up -d --scale ramalama=1
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π footprint –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –∏ –∫—ç—à
- Read-only –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `config/.env` –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `make buildx` –¥–ª—è –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `make pull`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±—ç–∫–∞–ø—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- `make help` - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `make test` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- `make config` - —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –õ–æ–≥–∏: `make logs`

---

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ