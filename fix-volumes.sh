#!/bin/bash

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Docker volumes –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Docker volumes"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö volumes
echo "1. –¢–µ–∫—É—â–∏–µ Docker volumes:"
docker volume ls | grep ramalama || echo "   Volumes –¥–ª—è ramalama –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
echo ""

# 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo "2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ ramalama:"
docker-compose down
echo ""

# 3. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
echo "3. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:"
docker system prune -f
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:"
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
sudo chown -R $(id -u):$(id -g) models/ data/ 2>/dev/null || true
chmod -R 755 models/ data/
echo "   ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã"
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
echo "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ:"
available_space=$(df -BG . | tail -1 | awk '{print $4}' | sed 's/G//')
echo "   –°–≤–æ–±–æ–¥–Ω–æ: ${available_space}GB"
if [ $available_space -lt 2 ]; then
    echo "   ‚ö†Ô∏è  –ú–∞–ª–æ –º–µ—Å—Ç–∞! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2GB"
else
    echo "   ‚úÖ –ú–µ—Å—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ"
fi
echo ""

# 6. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
echo "6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
echo "test" > models/test.txt
if [ -f "models/test.txt" ]; then
    echo "   ‚úÖ –ó–∞–ø–∏—Å—å –≤ models/ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    rm models/test.txt
else
    echo "   ‚ùå –ó–∞–ø–∏—Å—å –≤ models/ –ù–ï –†–ê–ë–û–¢–ê–ï–¢!"
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É"
fi

echo "test" > data/test.txt
if [ -f "data/test.txt" ]; then
    echo "   ‚úÖ –ó–∞–ø–∏—Å—å –≤ data/ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    rm data/test.txt
else
    echo "   ‚ùå –ó–∞–ø–∏—Å—å –≤ data/ –ù–ï –†–ê–ë–û–¢–ê–ï–¢!"
fi
echo ""

# 7. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
echo "7. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker Compose:"
docker-compose build --no-cache
echo ""

echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!"
echo ""
echo "üí° –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:"
echo "   docker-compose --profile no-proxy run --rm ramalama-no-proxy pull tinyllama"
echo ""
echo "üîç –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "   - –õ–æ–≥–∏ Docker: docker-compose logs"
echo "   - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: ls -la models/"
echo "   - –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ: df -h"