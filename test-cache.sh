#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è RamaLama

echo "üîç –ü–†–û–í–ï–†–ö–ê –°–ò–°–¢–ï–ú–´ –ö–ï–®–ò–†–û–í–ê–ù–ò–Ø"
echo "================================"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ cache
echo "üìÅ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ cache:"
if [ -d "cache" ]; then
    cache_size=$(du -sh cache 2>/dev/null | cut -f1)
    echo "  ‚úÖ cache/ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Ä–∞–∑–º–µ—Ä: $cache_size)"
else
    echo "  ‚ùå cache/ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    mkdir -p cache
    echo "  ‚úÖ cache/ —Å–æ–∑–¥–∞–Ω–∞"
fi

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
echo ""
echo "üê≥ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Docker:"
docker-compose config | grep -A5 -B5 "cache" || echo "  ‚ÑπÔ∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ docker-compose.yml"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo ""
echo "‚öôÔ∏è 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "  ‚Ä¢ HF_HUB_DISABLE_PROGRESS_BARS=false (–≤ config/.env)"
echo "  ‚Ä¢ HF_HUB_ENABLE_HF_TRANSFER=1 (–≤ config/.env)"
echo "  ‚Ä¢ PIP_NO_CACHE_DIR=1 (–≤ Dockerfile)"
echo "  ‚Ä¢ RAMALAMA_CACHE_PATH –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ HuggingFace
echo ""
echo "ü§ó 4. –¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è HuggingFace:"
echo "  –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å /workspace/cache"

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
docker run --rm \
    -v $(pwd)/cache:/workspace/cache:rw \
    --entrypoint sh \
    ramalama:latest \
    -c "ls -la /workspace/cache/ && echo '‚úÖ Cache –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ'"

echo ""
echo "üìä –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:"
echo "  ‚úÖ –§–∏–∑–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞"
echo "  ‚úÖ Docker –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
echo "  ‚úÖ HuggingFace –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ"
echo "  ‚úÖ PIP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ"
echo ""
echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "  ‚Ä¢ Cache –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
echo "  ‚Ä¢ HuggingFace –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª–∏"
echo "  ‚Ä¢ PIP –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç—ã (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)"
echo ""
echo "üéØ –°–ò–°–¢–ï–ú–ê –ö–ï–®–ò–†–û–í–ê–ù–ò–Ø –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!"