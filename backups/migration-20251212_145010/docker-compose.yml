services:
  ramalama:
    build: .
    image: ramalama:latest
    container_name: ramalama
    env_file: .env
    profiles: ["main"]
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º host network –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–∫—Å–∏
    network_mode: host
    
    environment:
      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ramalama (–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ .env —Ñ–∞–π–ª–∞)
      - RAMALAMA_IN_CONTAINER=1
      
      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
      - RAMALAMA_LOG_FILE=/workspace/data/logs/ramalama.log
      
      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
      - RAMALAMA_LOG_LEVEL=INFO
      - HF_HUB_DISABLE_PROGRESS_BARS=false
      - HF_HUB_ENABLE_HF_TRANSFER=1
    
    volumes:
      # –ú–æ–Ω—Ç–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
      - ./models:/workspace/models
      - ./data:/workspace/data
    
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º help
    command: ["tail", "-f", "/dev/null"]
    
    stdin_open: true
    tty: true
    restart: unless-stopped

  # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å –±–µ–∑ host network (–µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ –Ω—É–∂–µ–Ω)
  ramalama-no-proxy:
    build: .
    image: ramalama:latest
    container_name: ramalama-no-proxy
    profiles: ["no-proxy"]
    env_file: .env
    network_mode: bridge
    
    environment:
      # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –ø—Ä–æ–∫—Å–∏
      - HTTP_PROXY=
      - HTTPS_PROXY=
      - RAMALAMA_MODELS_PATH=/workspace/models
      - RAMALAMA_IN_CONTAINER=1
      
      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
      - RAMALAMA_LOG_FILE=/workspace/data/logs/ramalama.log
      
      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
      - RAMALAMA_LOG_LEVEL=INFO
      - HF_HUB_DISABLE_PROGRESS_BARS=false
      - HF_HUB_ENABLE_HF_TRANSFER=1
    
    volumes:
      - ./models:/workspace/models
      - ./data:/workspace/data
      
    command: ["tail", "-f", "/dev/null"]
    
    stdin_open: true
    tty: true
    restart: unless-stopped

  # üÜï –°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  check-mounts:
    image: alpine:latest
    container_name: check-mounts
    profiles: ["check"]  # –ü—Ä–æ—Ñ–∏–ª—å –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    volumes:
      - ./models:/workspace/models
      - ./data:/workspace/data
    
    # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    command: >
      sh -c "
        echo '=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ú–û–ù–¢–ò–†–û–í–ê–ù–ò–Ø ===' &&
        echo '–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:' &&
        pwd &&
        echo '' &&
        echo '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /workspace/models:' &&
        ls -la /workspace/models/ 2>/dev/null || echo '‚ùå models –Ω–µ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω' &&
        echo '' &&
        echo '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /workspace/data:' &&
        ls -la /workspace/data/ 2>/dev/null || echo '‚ùå data –Ω–µ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω' &&
        echo '' &&
        echo '–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:' &&
        stat /workspace/models 2>/dev/null || echo '‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ models' &&
        echo '=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ==='
      "
